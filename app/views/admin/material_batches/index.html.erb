<% content_for :main_content do %>
  <div class="main-content ">
    <div class="breadcrumbs" id="breadcrumbs">
      <ul class="breadcrumb">
        <%= render 'partials/home' %>
        <li><%= link_to '物资资产管理', admin_materials_path %></li>
        <li><%= link_to '物资资产', admin_materials_path %></li>
        <li><%= link_to '批次管理'%></li>
      </ul>
    </div>

    <div class="page-content">
      <%= form_for @search, url: admin_material_batches_path, html: { method: :get } do |f| %>
        <div class="no-padding col-md-12">

          <div class="col-md-2">
            <div class="input-group input-group-text">
              <%= f.text_field :no_like, placeholder: '请输入批次编号', class: "col-xs-12" %>
            </div>
          </div>

          <div class="col-md-2">
            <div class="input-group input-group-text">
              <%= f.text_field :material_name_like, placeholder: '请输入资产名称', class: "col-xs-12" %>
            </div>
          </div>

          <div class="col-md-2">
            <%= f.select :material_asset_category_id_eq, AssetCategory.type2.pluck(:name, :id), {:include_blank => '请选择分类'}, class: "col-xs-12" %>
          </div>

          <div class="col-md-2">
            <%= f.select :status_eq, MaterialBatch.status_options[0..1], {:include_blank => '请选择批次状态'}, class: "col-xs-12" %>
          </div>

          <div class="col-md-4">
            <%= f.submit '查询', class: 'btn btn-sm btn-filter btn-primary' %>
            <a class="btn btn-primary btn-sm pull-right" data-target="addBrand" data-toggle="modals" data-title="新增物资批次" data-height="1000" data-iframe="/admin/material_batches/new">新增</a>
          </div>
        </div>
      <% end %>

      <div class="col-md-12 margin-top-20">
        <table id="vweddingTable" class="table table-bordered table-hover dataTable ">
          <thead>
            <tr>
              <th>批次编号</th>
              <th>所属资产</th>
              <th>资产分类</th>
              <th>批次状态</th>
              <th>供应商</th>
              <th>保质期(月)</th>
              <th>仓库</th>
              <th>库存数量</th>
              <th>创建人</th>
              <th>批次入库时间</th>
              <th>操作</th>
            </tr>
          </thead>
          <tbody>
            <% @material_batches.each do |material_batch| %>
              <tr>
                <td><%= material_batch.no %></td>
                <td><%= material_batch.material.try(:name) %></td>
                <td><%= material_batch.material.asset_category.try(:name) %></td>
                <td><%= material_batch.status_name %></td>
                <td><%= material_batch.supplier.try(:name) %></td>
                <td><%= material_batch.expiration_date %></td>
                <td><%= material_batch.warehouse.try(:name) %></td>
                <td><%= material_batch.qty %></td>
                <td><%= material_batch.user.name %></td>
                <td><%= material_batch.time %></td>
                <td>
                  <%#= link_to '领用', receive_admin_material_batch_path(material_batch) %>
                  <a href="javascript:;" class="fgreen" data-target="editAsset" data-toggle="modals" data-title="物资数量调整" data-height="1000" data-iframe="/admin/material_batches/<%= material_batch.id%>/receive?type=1">入库</a>
                  <a href="javascript:;" class="fgreen" data-target="editAsset" data-toggle="modals" data-title="物资数量调整" data-height="1000" data-iframe="/admin/material_batches/<%= material_batch.id%>/receive?type=2">领用</a>
                  <a href="javascript:;" class="fgreen" data-target="editAsset" data-toggle="modals" data-title="物资数量调整" data-height="1000" data-iframe="/admin/material_batches/<%= material_batch.id%>/receive?type=4">数量调整</a>
                  <a href="javascript:;" class="fgreen" data-target="editAsset" data-toggle="modals" data-title="编辑资产" data-height="1000" data-iframe="/admin/material_batches/<%= material_batch.id%>/edit">编辑</a>
                  <%= link_to '删除', admin_material_batch_path(material_batch), method: :delete, data: {confirm: '确定删除？'} %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
        <div class="pagination page width-auto"><%= page_entries_info @material_batches %></div>
        <%= paginate @material_batches %>
      </div>
    </div>

  </div>
<% end %>
